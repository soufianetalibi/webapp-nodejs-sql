<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulaire de Contact - Azure SQL</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}
.container {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 1200px;
    width: 100%;
    display: grid;
    grid-template-columns: 1fr 1fr;
    overflow: hidden;
    animation: slideIn 0.5s ease-out;
}
@keyframes slideIn { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }
.form-section, .data-section { padding: 50px; }
.form-section { background: white; }
.form-section h1 { color: #667eea; font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
.form-section .subtitle { color: #666; margin-bottom: 30px; font-size: 1.1em; }
.form-group { margin-bottom: 25px; position: relative; }
.form-group label { display: block; color: #333; font-weight: 600; margin-bottom: 8px; font-size: 0.95em; }
.form-group input, .form-group textarea {
    width: 100%; padding: 15px 20px; border: 2px solid #e0e0e0; border-radius: 10px;
    font-size: 1em; background: #f8f9fa; transition: all 0.3s;
}
.form-group input:focus, .form-group textarea:focus {
    outline: none; border-color: #667eea; background: white;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}
.form-group textarea { resize: vertical; min-height: 120px; font-family: inherit; }
.btn {
    width: 100%; padding: 18px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600;
    cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px;
}
.btn:hover { transform: translateY(-2px); }
.btn:disabled { background: #ccc; cursor: not-allowed; }
.data-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; overflow-y: auto; max-height: 800px; }
.data-section h2 { font-size: 2em; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
.refresh-btn {
    background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white;
    padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9em;
    margin-left: auto;
}
.card { background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 25px; margin-bottom: 20px; }
.card h3 { font-size: 1.3em; margin-bottom: 10px; }
.card p { margin: 8px 0; line-height: 1.6; }
.delete-btn {
    background: rgba(220, 53, 69, 0.8); color: white; border: none; padding: 8px 15px;
    border-radius: 6px; cursor: pointer; font-size: 0.85em; margin-top: 10px;
}
.loader {
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid white;
    border-radius: 50%;
    width: 40px; height: 40px;
    animation: spin 1s linear infinite;
    margin: 50px auto;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
@media (max-width: 968px) { .container { grid-template-columns: 1fr; } .data-section { max-height: 500px; } }
.message { padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600; }
.message.success { background: #d4edda; color: #155724; }
.message.error { background: #f8d7da; color: #721c24; }
</style>
</head>
<body>
<div class="container">
    <div class="form-section">
        <h1>📋 Contact</h1>
        <p class="subtitle">Remplissez le formulaire ci-dessous</p>

        <div id="message"></div>

        <form id="contactForm">
            <div class="form-group">
                <label for="nom">👤 Nom complet *</label>
                <input type="text" id="nom" name="nom" required placeholder="Jean Dupont">
            </div>

            <div class="form-group">
                <label for="email">📧 Email *</label>
                <input type="email" id="email" name="email" required placeholder="jean.dupont@example.com">
            </div>

            <div class="form-group">
                <label for="telephone">📞 Téléphone</label>
                <input type="tel" id="telephone" name="telephone" placeholder="06 12 34 56 78">
            </div>

            <div class="form-group">
                <label for="messageInput">💬 Message</label>
                <textarea id="messageInput" name="message" placeholder="Votre message ici..."></textarea>
            </div>

            <button type="submit" class="btn" id="submitBtn">
                Envoyer le formulaire
            </button>
        </form>
    </div>

    <div class="data-section">
        <h2>
            📂 Données enregistrées
            <button class="refresh-btn" onclick="loadData()">🔄 Actualiser</button>
        </h2>
        <div id="dataContainer">
            <div class="loader"></div>
        </div>
    </div>
</div>

<script>
const API_URL = 'http://localhost:3000/api/formulaires';

document.addEventListener('DOMContentLoaded', () => loadData());

document.getElementById('contactForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = '⏳ Envoi en cours...';

    const formData = {
        nom: document.getElementById('nom').value,
        email: document.getElementById('email').value,
        telephone: document.getElementById('telephone').value,
        message: document.getElementById('messageInput').value
    };

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });
        const result = await response.json();

        if (result.success) {
            showMessage('✅ Formulaire envoyé avec succès !', 'success');
            document.getElementById('contactForm').reset();
            loadData();
        } else {
            showMessage('❌ Erreur: ' + result.error, 'error');
        }
    } catch (error) {
        showMessage('⚠️ Erreur de connexion au serveur', 'error');
        console.error(error);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Envoyer le formulaire';
    }
});

async function loadData() {
    const container = document.getElementById('dataContainer');
    container.innerHTML = '<div class="loader"></div>';

    try {
        const response = await fetch(API_URL);
        const result = await response.json();

        if (result.success && result.data.length > 0) {
            container.innerHTML = result.data.map(item => `
                <div class="card">
                    <h3>👤 ${item.nom}</h3>
                    <p><strong>📧 Email:</strong> ${item.email}</p>
                    ${item.telephone ? `<p><strong>📞 Téléphone:</strong> ${item.telephone}</p>` : ''}
                    ${item.message ? `<p><strong>💬 Message:</strong> ${item.message}</p>` : ''}
                    <div class="meta">
                        <p>🆔 ID: ${item.id}</p>
                        ${item.date_creation ? `<p>🕒 ${new Date(item.date_creation).toLocaleString('fr-FR')}</p>` : ''}
                    </div>
                    <button class="delete-btn" onclick="deleteItem(${item.id})">🗑️ Supprimer</button>
                </div>
            `).join('');
        } else {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>Aucune donnée</h3>
                    <p>Les formulaires soumis apparaîtront ici</p>
                </div>
            `;
        }
    } catch (error) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>⚠️ Erreur de connexion</h3>
                <p>Impossible de charger les données</p>
                <button class="refresh-btn" onclick="loadData()" style="margin-top: 20px;">Réessayer</button>
            </div>
        `;
        console.error(error);
    }
}

async function deleteItem(id) {
    if (!confirm('Voulez-vous vraiment supprimer cet élément ?')) return;

    try {
        const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        const result = await response.json();

        if (result.success) {
            showMessage('🗑️ Élément supprimé', 'success');
            loadData();
        } else {
            showMessage('❌ Erreur lors de la suppression', 'error');
        }
    } catch (error) {
        showMessage('⚠️ Erreur de connexion', 'error');
        console.error(error);
    }
}

function showMessage(text, type) {
    const messageDiv = document.getElementById('message');
    messageDiv.innerHTML = `<div class="message ${type}">${text}</div>`;
    setTimeout(() => { messageDiv.innerHTML = ''; }, 5000);
}
</script>
</body>
</html>
